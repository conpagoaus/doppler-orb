description: >
  Loads doppler secrets to environment variables.
  When using service token(token for specific project) its not required to specify project.
  When using user personal token project is required.
parameters:
  project:
    description: >
      Doppler project to use when personal token is used.
    type: string
    default: ""
  doppler_token:
    description: >
      Name of environment variable to access doppler token from.
    type: env_var_name
    default: DOPPLER_TOKEN
steps:
  - run:
      name: Load Doppler secrets
      command: |
        doppler secrets download -t ${<< parameters.doppler_token >>} --no-file --format env --project << parameters.project >> > doppler.env
        sed -e 's/^/export /' doppler.env >> $BASH_ENV
        source $BASH_ENV
